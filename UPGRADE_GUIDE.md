# 升级指南 - v1.0.2

## 重要提示

**此版本包含重要的数据库结构更新，升级前请务必导出现有数据。**

## 升级步骤

### 1. 导出现有数据（旧版本）

在安装新版本之前，请先在旧版本中导出所有数据：

1. 打开当前版本的应用
2. 点击"导出"按钮
3. 保存导出的 Excel 文件到安全位置
4. 确认文件已成功保存
5. 关闭应用

### 2. 安装新版本

1. 下载 `Travel Agent System v1.0.2` 安装包
2. 运行安装程序
3. 安装程序会覆盖旧版本文件

### 3. 首次启动新版本

首次启动时会看到数据库升级提示：

```
重要：数据库升级

检测到数据库需要升级

⚠️ 重要提示：此次升级需要重置数据库

建议操作步骤：
1. 点击"取消"退出应用
2. 启动旧版本应用
3. 使用"导出"功能保存所有数据
4. 重新启动新版本应用
5. 选择"重置数据库"（推荐）
6. 使用"导入"功能恢复数据
```

**选项说明：**

- **重置数据库**（推荐）：删除旧数据库，创建新的空数据库
- **取消**：退出应用，返回导出数据

### 4. 重置数据库

1. 点击"重置数据库"
2. 确认重置操作
3. 应用将以全新数据库启动

### 5. 导入数据

1. 在新版本中点击"导入"按钮
2. 选择之前导出的 Excel 文件
3. 确认导入成功
4. 所有客户和订单数据已恢复

## 如果忘记导出数据怎么办？

如果您已经安装新版本但忘记导出数据：

1. 在升级提示中点击"取消"退出新版本
2. 找到旧版本安装包（如果已删除，请向我们索取）
3. 重新安装旧版本
4. 导出数据
5. 再次安装新版本并导入数据

## 数据库文件位置

如果需要手动备份数据库文件：

**Windows:**
```
C:\Users\<你的用户名>\AppData\Roaming\Travel Agent System\data.db
```

**macOS:**
```
/Users/<你的用户名>/Library/Application Support/Travel Agent System/data.db
```

## 本次更新内容

### 新功能
- ✅ 自动数据库迁移系统
- ✅ 订单项目级别的付款状态跟踪（更灵活的付款管理）

### 问题修复
- ✅ 修复导入数据后交易不显示的问题
- ✅ 修复对账单导出功能
- ✅ 修复搜索功能的多个问题

### 改进
- ✅ 优化数据结构，提升性能
- ✅ 改进错误处理和数据一致性

## 需要帮助？

如果在升级过程中遇到任何问题，请联系技术支持。
